{"version":3,"file":"lib_jbtoc_js.b5fafae563e7d60b810a.js","mappings":"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","sources":["webpack://jb-toc/./src/index.ts","webpack://jb-toc/./src/jb1.ts","webpack://jb-toc/./src/jb2.ts","webpack://jb-toc/./src/jbtoc.ts"],"sourcesContent":["import {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin,\n  ILabShell\n} from '@jupyterlab/application';\nimport { Widget } from '@lumino/widgets';\n\nimport { FileBrowser } from '@jupyterlab/filebrowser';\n\nimport { IDocumentManager } from '@jupyterlab/docmanager';\nimport { IFileBrowserFactory } from '@jupyterlab/filebrowser';\n\nimport * as jbtoc from './jbtoc';\n\nlet appInstance: JupyterFrontEnd | null = null;\n\nexport function getJupyterAppInstance(app?: JupyterFrontEnd): JupyterFrontEnd {\n  if (!appInstance && app) {\n    appInstance = app;\n  }\n  if (!appInstance) {\n    throw new Error('App instance has not been initialized yet');\n  }\n  return appInstance;\n}\n\nconst plugin: JupyterFrontEndPlugin<void> = {\n  id: 'jb-toc:plugin',\n  description:\n    'A JupyterLab extension that mimics jupyter-book chapter navigation on an un-built, cloned jupyter book in JupyterLab.',\n  autoStart: true,\n  requires: [ILabShell, IFileBrowserFactory, IDocumentManager],\n  activate: async (\n    app: JupyterFrontEnd,\n    shell: ILabShell,\n    fileBrowserFactory: IFileBrowserFactory,\n    docManager: IDocumentManager\n  ) => {\n    getJupyterAppInstance(app);\n    console.log('JupyterLab extension jb-toc is activated!');\n\n    const widget = new Widget();\n    widget.id = '@jupyterlab-sidepanel/jb-toc';\n    widget.title.iconClass = 'jbook-icon jp-SideBar-tabIcon';\n    widget.title.className = 'jbook-tab';\n    widget.title.caption = 'Jupyter-Book Table of Contents';\n\n    const summary = document.createElement('p');\n    widget.node.appendChild(summary);\n    widget.activate = async () => {\n      const fileBrowser = fileBrowserFactory.tracker.currentWidget;\n      if (!fileBrowser) {\n        console.debug('File browser widget is null.');\n      } else {\n        console.debug('Active file browser widget found.');\n      }\n\n      try {\n        const cwd = fileBrowser?.model.path;\n        if (typeof cwd === 'string') {\n          const toc = await jbtoc.getTOC(cwd);\n          summary.innerHTML = toc;\n        }\n        addClickListenerToButtons(fileBrowser, docManager);\n        addClickListenerToChevron();\n      } catch (reason) {\n        console.error(`jb_toc error: ${reason}`);\n      }\n    };\n    shell.add(widget, 'left', { rank: 400 });\n    widget.activate();\n  }\n};\n\nexport default plugin;\n\nfunction addClickListenerToChevron() {\n  const buttons = document.querySelectorAll('.toc-chevron');\n  buttons.forEach(buttonElement => {\n    const button = buttonElement as HTMLButtonElement;\n    button.addEventListener('click', (event: Event) => {\n      toggleList(button);\n    });\n  });\n}\n\nfunction toggleList(button: HTMLButtonElement): void {\n  const list = button.parentElement?.nextElementSibling as HTMLElement | null;\n  if (!list) {\n    return;\n  }\n\n  const isHidden = list.hidden;\n  list.hidden = !isHidden;\n\n  button.setAttribute('aria-expanded', String(!isHidden));\n  button.innerHTML = isHidden\n    ? '<i class=\"fa fa-chevron-up toc-chevron\"></i>'\n    : '<i class=\"fa fa-chevron-down toc-chevron\"></i>';\n}\n\nfunction addClickListenerToButtons(\n  fileBrowser: FileBrowser | null,\n  docManager: IDocumentManager\n) {\n  const buttons = document.querySelectorAll('.toc-button');\n  buttons.forEach(button => {\n    button.addEventListener('click', (event: Event) => {\n      if (!fileBrowser) {\n        console.error('File browser not found');\n        return;\n      }\n\n      const toc_div = button.closest('.jbook-toc');\n      if (!toc_div) {\n        console.error('jbook-toc div not found');\n        return;\n      }\n\n      const toc_dir = toc_div.getAttribute('data-toc-dir');\n      if (typeof toc_dir !== 'string') {\n        console.error('data-toc-dir attribute loaded');\n        return;\n      }\n\n      if (typeof fileBrowser.model.path !== 'string') {\n        console.error(\n          `Invalid path: The current path is either not set or not a string. Path: ${fileBrowser.model.path}`\n        );\n        return;\n      }\n      console.debug(`Current directory: ${fileBrowser.model.path}`);\n\n      const filePath = button.getAttribute('data-file-path');\n      if (typeof filePath === 'string') {\n        if (filePath.includes('.md')) {\n          docManager.openOrReveal(filePath, 'Markdown Preview');\n        } else {\n          docManager.openOrReveal(filePath);\n        }\n      }\n    });\n  });\n}\n","import * as yaml from 'js-yaml';\n\nimport * as jbtoc from './jbtoc';\n\ninterface JBook1Config {\n  title: string;\n  author: string;\n  logo: string;\n}\n\nexport interface JBook1TOC {\n  parts?: Part[];\n  chapters?: Section[];\n  caption?: string;\n}\n\ninterface Section {\n  sections?: Section[];\n  file?: string;\n  url?: string;\n  title?: string;\n  glob?: string;\n}\n\ninterface Part {\n  caption: string;\n  chapters: Section[];\n}\n\nfunction isJBook1Config(obj: any): obj is JBook1Config {\n  return (\n    obj &&\n    typeof obj === 'object' &&\n    typeof obj.title === 'string' &&\n    typeof obj.author === 'string'\n  );\n}\n\nexport async function getJBook1Config(\n  configPath: string\n): Promise<{ title: string | null; author: string | null }> {\n  try {\n    const yamlStr = await jbtoc.getFileContents(configPath);\n    if (typeof yamlStr === 'string') {\n      const config: unknown = yaml.load(yamlStr);\n      if (isJBook1Config(config)) {\n        const title = config.title || 'Untitled Jupyter Book';\n        const author = config.author || 'Anonymous';\n        return { title, author };\n      } else {\n        console.error('Error: Misconfigured Jupyter Book config.');\n      }\n    }\n  } catch (error) {\n    console.error('Error reading or parsing config:', error);\n  }\n  return { title: null, author: null };\n}\n\nasync function getSubSection(\n  parts: Section[],\n  cwd: string,\n  level: number = 1,\n  html: string = ''\n): Promise<string> {\n  if (cwd && cwd.slice(-1) !== '/') {\n    cwd = cwd + '/';\n  }\n\n  async function insertFile(file: string) {\n    const parts = file.split('/');\n    parts.pop();\n    const k_dir = parts.join('/');\n    const pth = await jbtoc.getFullPath(file, `${cwd}${k_dir}`);\n    let title;\n    if (typeof pth === 'string') {\n      title = await jbtoc.getFileTitleFromHeader(pth);\n    }\n    if (!title) {\n      title = file;\n    }\n    html += `<button class=\"jp-Button toc-button tb-level${level}\" data-file-path=\"${jbtoc.escAttr(encodeURI(String(pth)))}\">${jbtoc.escHtml(String(title))}</button>`;\n  }\n  for (const k of parts) {\n    if (k.sections && k.file) {\n      const parts = k.file.split('/');\n      parts.pop();\n      const k_dir = parts.join('/');\n      const pth = await jbtoc.getFullPath(k.file, `${cwd}${k_dir}`);\n      let title;\n      if (typeof pth === 'string') {\n        title = await jbtoc.getFileTitleFromHeader(pth);\n      }\n      if (!title) {\n        title = k.file;\n      }\n      title = jbtoc.escHtml(String(title));\n      html += `\n        <div class=\"toc-row\">\n            <button type=\"button\" class=\"jp-Button toc-button \n              tb-level${level}\" \n              data-file-path=\"${jbtoc.escAttr(encodeURI(String(pth)))}\"\n              >${jbtoc.escHtml(String(title))}</button>\n            <button type=\"button\" class=\"jp-Button toc-chevron\"><i class=\"fa fa-chevron-down \"></i></button>\n        </div>\n        <div class=\"toc-children\" hidden>\n        `;\n      const html_cur = html;\n      html = await getSubSection(\n        k.sections,\n        cwd,\n        (level = level + 1),\n        (html = html_cur)\n      );\n      level = level - 1;\n      html += '</div>';\n    } else if (k.file) {\n      await insertFile(k.file);\n    } else if (k.url) {\n      const url = String(jbtoc.escAttr(encodeURI(k.url)));\n      html += `<button class=\"jp-Button toc-button toc-link tb-level${level}\">\n        <a class=\"toc-link tb-level${level}\" \n        href=\"${jbtoc.escAttr(encodeURI(String(url)))}\" \n        target=\"_blank\" \n        rel=\"noopener noreferrer\" \n        >${jbtoc.escHtml(String(k.title))}</a></button>`;\n    } else if (k.glob) {\n      const files = await jbtoc.globFiles(`${cwd}${k.glob}`);\n      for (const file of files) {\n        const relative = file.replace(`${cwd}`, '');\n        await insertFile(relative);\n      }\n    }\n  }\n  return html;\n}\n\nexport async function jBook1TOCToHtml(\n  toc: JBook1TOC,\n  cwd: string\n): Promise<string> {\n  let html = '\\n<ul>';\n  if (toc.parts) {\n    for (const chapter of toc.parts) {\n      html += `\\n<p class=\"caption\" role=\"heading\"><span class=\"caption-text\"><b>\\n${jbtoc.escHtml(String(chapter.caption))}\\n</b></span>\\n</p>`;\n      const subSectionHtml = await getSubSection(chapter.chapters, cwd);\n      html += `\\n${subSectionHtml}`;\n    }\n  } else {\n    if (toc.chapters) {\n      const subSectionHtml = await getSubSection(toc.chapters, cwd);\n      html += `\\n${subSectionHtml}`;\n    }\n  }\n  html += '\\n</ul>';\n  return html;\n}\n","import * as jbtoc from './jbtoc';\nexport interface Myst {\n  project?: MystProject;\n}\n\nexport interface MystProject {\n  title?: string;\n  subtitle?: string;\n  authors?: MystAuthors[];\n  doi?: string;\n  github?: string;\n  license?: string;\n  copyright?: string;\n  toc: MystTOC[];\n}\n\ninterface MystAuthors {\n  name?: string;\n}\n\nexport interface MystTOC {\n  file?: string;\n  title?: string;\n  children?: MystTOC[];\n  url?: string;\n  glob?: string;\n}\n\nexport async function mystTOCToHtml(\n  toc: MystTOC[],\n  cwd: string,\n  level: number = 1\n): Promise<jbtoc.TOCHTML> {\n  async function insertFile(file: string, chevron: boolean = false) {\n    const pth = await jbtoc.getFullPath(file, cwd);\n    pathsSet.add(String(pth));\n\n    const sectionId = `sec-${Math.random().toString(36).slice(2)}`;\n    const tHTML = jbtoc.htmlTok(pth);\n    const tATTR = jbtoc.attrTok(pth);\n\n    let file_html;\n    if (chevron) {\n      file_html = `<div class=\"toc-row\">\n        <button\n          type=\"button\"\n          class=\"jp-Button toc-button tb-level${level} toc-file\"\n          data-file-path=\"${pth}\"\n          aria-label=\"Open ${tATTR}\"\n        ><b>${tHTML}</b></button>\n\n        <button\n          type=\"button\"\n          class=\"jp-Button toc-chevron\"\n          aria-expanded=\"false\"\n          aria-controls=\"${sectionId}\"\n          aria-label=\"Toggle section for ${tATTR}\"\n        ><i class=\"fa fa-chevron-down\"></i></button>\n      </div>\n      <div id=\"${sectionId}\" class=\"toc-children\" hidden>\n    `;\n    } else {\n      file_html = `<button\n        class=\"jp-Button toc-button tb-level${level}\"\n        data-file-path=\"${pth}\"\n        aria-label=\"Open ${tATTR}\"\n      >\n        ${tHTML}\n      </button>`;\n    }\n    return file_html;\n  }\n\n  async function insertMystTitle(htmlTitle: string, attrTitle: string) {\n    const sectionId = `sec-${Math.random().toString(36).slice(2)}`;\n\n    return `\n      <div class=\"toc-row\">\n        <p class=\"caption tb-level${level}\" role=\"heading\" aria-level=\"${level}\">\n          <b>${htmlTitle}</b>\n        </p>\n        <button\n          type=\"button\"\n          class=\"jp-Button toc-chevron\"\n          aria-expanded=\"false\"\n          aria-controls=\"${sectionId}\"\n          aria-label=\"Toggle section for ${attrTitle}\"\n        ><i class=\"fa fa-chevron-down\"></i>\n        </button>\n      </div>\n      <div id=\"${sectionId}\" class=\"toc-children\" hidden>\n    `;\n  }\n\n  async function insertUrl(htmlTitle: string, attrTitle: string, url: string) {\n    return `\n    <div class=\"toc-row\">\n      <a\n        class=\"jp-Button toc-button toc-link tb-level${level}\"\n        href=\"${url}\"\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        aria-label=\"Open external link to ${attrTitle}\"\n      >\n        ${htmlTitle}\n      </a>\n    </div>\n    `;\n  }\n\n  if (cwd && cwd.slice(-1) !== '/') {\n    cwd = cwd + '/';\n  }\n\n  const pathsSet = new Set<string>();\n\n  const html_snippets: string[] = [];\n  for (const item of toc) {\n    const htmlTitle = item.title ? jbtoc.escHtml(String(item.title)) : '';\n    const attrTitle = item.title ? jbtoc.escAttr(String(item.title)) : '';\n    const url = item.url ? jbtoc.escAttr(encodeURI(String(item.url))) : '';\n\n    if ((item.title || item.file) && item.children) {\n      if (item.file) {\n        html_snippets.push(await insertFile(item.file, true));\n      } else if (item.title) {\n        html_snippets.push(await insertMystTitle(htmlTitle, attrTitle));\n      }\n      const children = await mystTOCToHtml(item.children, cwd, level + 1);\n      children.paths.forEach(p => pathsSet.add(p));\n      html_snippets.push(children.html);\n      html_snippets.push('</div>');\n    } else if (item.file) {\n      html_snippets.push(await insertFile(item.file));\n    } else if (item.url && item.title) {\n      html_snippets.push(await insertUrl(htmlTitle, attrTitle, url));\n    } else if (item.glob) {\n      const files = await jbtoc.globFiles(`${cwd}${item.glob}`);\n      for (const file of files) {\n        const relative = file.replace(`${cwd}`, '');\n        html_snippets.push(await insertFile(relative));\n      }\n    }\n  }\n  return { html: html_snippets.join(''), paths: Array.from(pathsSet) };\n}\n\nexport async function getHtmlTop(\n  project: MystProject,\n  configParent: string\n): Promise<string> {\n  let html_top = `<div class=\"jbook-toc\" data-toc-dir=\"${configParent}\">`;\n\n  if (project.title) {\n    html_top += `<p id=\"toc-title\">${jbtoc.escHtml(String(project.title))}</p>`;\n  }\n  if (project.subtitle) {\n    html_top += `<p id=\"toc-subtitle\">${jbtoc.escHtml(String(project.subtitle))}</p>`;\n  }\n  html_top += '<br><hr class=\"toc-hr\">';\n  return html_top;\n}\n\nexport async function getHtmlBottom(project: MystProject): Promise<string> {\n  function getDOIHtml(doi: string) {\n    if (!doi) {\n      return '';\n    }\n\n    doi = String(doi).trim();\n    const match = doi.match(/10\\.\\S+/);\n    if (match) {\n      doi = match[0];\n    }\n\n    const doiUrl = `https://doi.org/${doi}`;\n    const encoded = encodeURIComponent(doi);\n\n    return `\n  <a\n    href=\"${doiUrl}\"\n    target=\"_blank\"\n    rel=\"noopener noreferrer\"\n    class=\"toc-link badge-link\"\n    aria-label=\"Open DOI ${doi} (opens in a new tab)\"\n  >\n    <img\n      src=\"https://img.shields.io/static/v1?label=DOI&message=${encoded}&color=0A84FF\"\n      alt=\"DOI: ${doi}\"\n      loading=\"lazy\"\n    >\n  </a>`;\n  }\n\n  function getGithubHtml(github: string) {\n    let githubUrl: string;\n    let githubLabel: string;\n\n    const githubValue = String(github).trim();\n\n    if (\n      githubValue.startsWith('http://') ||\n      githubValue.startsWith('https://')\n    ) {\n      githubUrl = githubValue;\n      const match = githubValue.match(/github\\.com\\/([^/]+\\/[^/]+)/);\n      githubLabel = match ? match[1] : githubValue;\n    } else {\n      githubLabel = githubValue;\n      githubUrl = `https://github.com/${githubValue}`;\n    }\n\n    const githubEscaped = jbtoc.escAttr(encodeURI(githubLabel));\n\n    return `\n      <a\n        href=\"${githubUrl}\"\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        class=\"toc-link github-link\"\n        aria-label=\"Open GitHub repository ${githubEscaped} (opens in a new tab)\"\n      >\n        <img\n          src=\"https://img.shields.io/badge/GitHub-5c5c5c?logo=github\"\n          alt=\"GitHub badge for ${githubEscaped}\"\n          loading=\"lazy\"\n        >\n      </a>\n    `;\n  }\n\n  let html_bottom = '<br><hr class=\"toc-hr\"><br>';\n\n  if (Array.isArray(project.authors) && project.authors.length) {\n    const names = project.authors\n      .filter(a => a && a.name)\n      .map(a => jbtoc.escHtml(String(a.name)));\n\n    if (names.length) {\n      const label = names.length === 1 ? 'Author:' : 'Authors:';\n      html_bottom += `<p id=\"toc-author\">${label} ${names.join(', ')}</p>`;\n    }\n  }\n\n  if (project.github || project.license || project.doi) {\n    html_bottom += '<div class=\"badges\">';\n  }\n\n  if (project.github) {\n    html_bottom += getGithubHtml(project.github);\n  }\n\n  if (project.license) {\n    const license = String(project.license);\n    html_bottom += `\n      <a\n        href=\"https://opensource.org/licenses/${license}\"\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        class=\"toc-link badge-link\"\n        aria-label=\"Open ${license} license text (opens in a new tab)\"\n      >\n        <img\n          src=\"https://img.shields.io/static/v1?label=License&message=${encodeURIComponent(license)}&color=0A84FF\"\n          alt=\"License: ${license}\"\n          loading=\"lazy\"\n        >\n      </a>\n    `;\n  }\n\n  if (project.doi) {\n    html_bottom += getDOIHtml(project.doi);\n  }\n\n  if (project.github || project.license || project.doi) {\n    html_bottom += '</div>';\n  }\n\n  if (project.copyright) {\n    html_bottom += `\n      <p style=\"padding-left: 15px\">Copyright Â© ${jbtoc.escHtml(String(project.copyright))}</p>\n    `;\n  }\n  return html_bottom;\n}\n","import { ServerConnection } from '@jupyterlab/services';\nimport { URLExt } from '@jupyterlab/coreutils';\n\nimport * as path from 'path';\nimport * as yaml from 'js-yaml';\nimport { getJupyterAppInstance } from './index';\n\nimport * as jb1 from './jb1';\nimport * as jb2 from './jb2';\n\ninterface FileMetadata {\n  path: string;\n  name: string;\n}\n\ninterface Notebook {\n  cells: Cell[];\n}\n\ninterface Cell {\n  cell_type: 'markdown';\n  metadata: { object: any };\n  source: string;\n}\n\nexport type TOCHTML = { html: string; paths: string[] };\n\nexport async function getFileContents(path: string): Promise<string> {\n  try {\n    const app = getJupyterAppInstance();\n    const data = await app.serviceManager.contents.get(path, { content: true });\n    if (data.type === 'notebook' || data.type === 'file') {\n      return data.content as string;\n    } else {\n      throw new Error(`Unsupported file type: ${data.type}`);\n    }\n  } catch (error) {\n    console.error(`Failed to get file contents for ${path}:`, error);\n    throw error;\n  }\n}\n\nexport async function ls(pth: string): Promise<any> {\n  if (pth === '') {\n    pth = '/';\n  }\n\n  try {\n    const app = getJupyterAppInstance();\n    return await app.serviceManager.contents.get(pth, { content: true });\n  } catch (error) {\n    console.error('Error listing directory contents:', error);\n    return null;\n  }\n}\n\nexport function escHtml(str: string): string {\n  if (str === null) {\n    return '';\n  }\n  const s = String(str);\n  return s\n    .replaceAll(/&/g, '&amp;')\n    .replaceAll(/</g, '&lt;')\n    .replaceAll(/>/g, '&gt;');\n}\n\nexport function escAttr(str: string): string {\n  if (str === null) {\n    return '';\n  }\n  const s = String(str);\n  return escHtml(s).replaceAll(/\"/g, '&quot;').replaceAll(/'/g, '&#39;');\n}\n\nfunction encodePath(path: string) {\n  return encodeURIComponent(path);\n}\n// Used to create placeholder tokens for titles on initial toc html generation.\n// They will later be updated with titles effieicently retreived on the backend when possible.\nexport function htmlTok(path: string): string {\n  return `[[TITLE_HTML::${encodePath(path)}]]`;\n}\nexport function attrTok(path: string): string {\n  return `[[TITLE_ATTR::${encodePath(path)}]]`;\n}\n\nasync function findConfigInParents(cwd: string): Promise<string | null> {\n  const configPatterns: string[] = ['myst.yml', '_toc.yml'];\n  for (const configPattern of configPatterns) {\n    const dirs = cwd.split('/');\n    let counter: number = 0;\n    while (counter < 1) {\n      const pth = dirs.join('/');\n      const files = await ls(pth);\n      for (const value of Object.values(files.content)) {\n        const file = value as FileMetadata;\n        if (file.path.endsWith(configPattern)) {\n          return file.path;\n        }\n      }\n      if (dirs.length === 0) {\n        counter += 1;\n      } else {\n        dirs.pop();\n      }\n    }\n  }\n\n  return null;\n}\n\nexport function getFullPath(relFile: string, bookRoot: string): string {\n  // const fullPath = new URL(relFile, bookRoot + '/').pathname;\n  // console.log(fullPath);\n  return path.posix.normalize(\n    (bookRoot.endsWith('/') ? bookRoot : bookRoot + '/') + relFile\n  );\n}\n\nfunction isNotebook(obj: any): obj is Notebook {\n  return obj && typeof obj === 'object' && Array.isArray(obj.cells);\n}\n\nexport async function getFileTitleFromHeader(\n  filePath: string\n): Promise<string | null> {\n  const suffix = path.extname(filePath);\n  if (suffix === '.ipynb') {\n    try {\n      const jsonData: Notebook | string = await getFileContents(filePath);\n      if (isNotebook(jsonData)) {\n        const headerCells = jsonData.cells.filter(cell => {\n          if (cell.cell_type === 'markdown') {\n            const source = Array.isArray(cell.source)\n              ? cell.source.join('')\n              : cell.source;\n            return source.split('\\n').some(line => line.startsWith('# '));\n          }\n          return false;\n        });\n\n        const firstHeaderCell = headerCells.length > 0 ? headerCells[0] : null;\n        if (firstHeaderCell) {\n          if (firstHeaderCell.source.split('\\n')[0].slice(0, 2) === '# ') {\n            const title: string = firstHeaderCell.source\n              .split('\\n')[0]\n              .slice(2);\n            return title;\n          }\n        }\n      }\n    } catch (error) {\n      console.error('Error reading or parsing notebook:', error);\n    }\n  } else if (suffix === '.md') {\n    try {\n      const md: Notebook | string = await getFileContents(filePath);\n      if (!isNotebook(md)) {\n        const lines: string[] = md.split('\\n');\n        for (const line of lines) {\n          if (line.slice(0, 2) === '# ') {\n            return line.slice(2);\n          }\n        }\n      }\n    } catch (error) {\n      console.error('Error reading or parsing Markdown:', error);\n    }\n  }\n  return null;\n}\n\nexport async function globFiles(pattern: string): Promise<string[]> {\n  const baseDir = '';\n  const result: string[] = [];\n\n  try {\n    const app = getJupyterAppInstance();\n    const data = await app.serviceManager.contents.get(baseDir, {\n      content: true\n    });\n    const regex = new RegExp(pattern);\n    for (const item of data.content) {\n      if (item.type === 'file' && regex.test(item.path)) {\n        result.push(item.path);\n      }\n    }\n  } catch (error) {\n    console.error(`Error globbing pattern ${pattern}`, error);\n  }\n\n  return result;\n}\n\nlet prettierModPromise:\n  | Promise<typeof import('prettier/standalone')>\n  | undefined;\nlet htmlPluginPromise: Promise<any> | undefined;\n\nexport async function formatHtmlForDev(html: string): Promise<string> {\n  if (process.env.NODE_ENV !== 'development') {\n    return html;\n  }\n\n  prettierModPromise ??= import('prettier/standalone').catch(err => {\n    prettierModPromise = undefined;\n    throw err;\n  });\n\n  htmlPluginPromise ??= import('prettier/plugins/html')\n    .then(m => (m as any).default ?? m)\n    .catch(err => {\n      htmlPluginPromise = undefined;\n      throw err;\n    });\n\n  const [prettierMod, htmlPlugin] = await Promise.all([\n    prettierModPromise,\n    htmlPluginPromise\n  ]);\n\n  const prettier: any = (prettierMod as any).default ?? prettierMod;\n  const parserHtml = (htmlPlugin as any).default ?? htmlPlugin;\n\n  return await prettier.format(html, {\n    parser: 'html',\n    plugins: [parserHtml]\n  });\n}\n\nfunction replaceAll(haystack: string, needle: string, replacement: string) {\n  return haystack.split(needle).join(replacement);\n}\n\nfunction stem(path: string) {\n  const base = path.split('/').pop() ?? path;\n  return base.replace(/\\.[^.]+$/, '');\n}\n\nexport async function fetchTitlesBackend(\n  paths: string[]\n): Promise<Record<string, { title: string; last_modified?: string }>> {\n  const settings = ServerConnection.makeSettings();\n  const url = URLExt.join(settings.baseUrl, 'jbtoc', 'titles');\n  const resp = await ServerConnection.makeRequest(\n    url,\n    {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ paths })\n    },\n    settings\n  );\n\n  if (!resp.ok) {\n    throw new Error(`${resp.status} ${resp.statusText}`);\n  }\n\n  const data = (await resp.json()) as {\n    titles: Record<string, { title?: string; last_modified?: string }>;\n  };\n\n  const out: Record<string, { title: string; last_modified?: string }> = {};\n  for (const [p, v] of Object.entries(data.titles)) {\n    if (v?.title) {\n      out[p] = { title: v.title, last_modified: v.last_modified };\n    }\n  }\n  return out;\n}\n\nasync function fetchTitlesFrontend(paths: string[]) {\n  const out: Record<string, { title: string }> = {};\n  for (const p of paths) {\n    try {\n      let t = await getFileTitleFromHeader(String(p));\n      if (!t) {\n        t = stem(p);\n      }\n      out[p] = { title: String(t) };\n    } catch {\n      out[p] = { title: stem(p) };\n    }\n  }\n  return out;\n}\n\nfunction applyTitles(\n  html: string,\n  titleMap: Record<string, { title: string }>\n) {\n  for (const [path, { title }] of Object.entries(titleMap)) {\n    const safeHtml = escHtml(String(title));\n    const safeAttr = escAttr(String(title));\n    html = replaceAll(html, htmlTok(path), safeHtml);\n    html = replaceAll(html, attrTok(path), safeAttr);\n  }\n  return html;\n}\n\nexport async function getTOC(cwd: string): Promise<string> {\n  const tocPath = await findConfigInParents(cwd);\n  let configPath = null;\n  let configParent = null;\n  let html: string | undefined | Error | any;\n  if (tocPath) {\n    const myst = tocPath.endsWith('myst.yml');\n    const parts = tocPath.split('/');\n\n    parts.pop();\n    configParent = parts.join('/');\n\n    if (!myst) {\n      const files = await ls(configParent);\n      const configPattern = '_config.yml';\n      for (const value of Object.values(files.content)) {\n        const file = value as FileMetadata;\n        if (file.name === configPattern) {\n          configPath = file.path;\n          break;\n        }\n      }\n    }\n\n    if (\n      !myst &&\n      configParent !== null &&\n      configParent !== undefined &&\n      configPath\n    ) {\n      try {\n        const tocYamlStr = await getFileContents(tocPath);\n        if (typeof tocYamlStr === 'string') {\n          const tocYaml: unknown = yaml.load(tocYamlStr);\n          const toc = tocYaml as jb1.JBook1TOC;\n          const config = await jb1.getJBook1Config(configPath);\n          const toc_html = await jb1.jBook1TOCToHtml(toc, configParent);\n          html = `\n          <div class=\"jbook-toc\" data-toc-dir=\"${configParent}\">\n            <p id=\"toc-title\">${escHtml(String(config.title))}</p>\n            <p id=\"toc-author\">Author: ${escHtml(String(config.author))}</p>\n            ${toc_html}\n          </div>\n          `;\n        } else {\n          console.error('Error: Misconfigured Jupyter Book _toc.yml.');\n        }\n      } catch (error) {\n        console.error('Error reading or parsing _toc.yml:', error);\n      }\n    } else if (myst && configParent !== null && configParent !== undefined) {\n      try {\n        const mystYAMLStr = await getFileContents(tocPath);\n        if (typeof mystYAMLStr === 'string') {\n          const mystYaml: unknown = yaml.load(mystYAMLStr);\n          const yml = mystYaml as jb2.Myst;\n          const project = yml.project as jb2.MystProject;\n\n          const html_top = await jb2.getHtmlTop(project, configParent);\n\n          const { html: tocHtmlRaw, paths } = await jb2.mystTOCToHtml(\n            project.toc,\n            configParent\n          );\n          let map: Record<string, { title: string; last_modified?: string }>;\n          try {\n            map = await fetchTitlesBackend(paths);\n          } catch {\n            map = await fetchTitlesFrontend(paths);\n          }\n          const toc_html = applyTitles(tocHtmlRaw, map);\n\n          const html_bottom = await jb2.getHtmlBottom(project);\n\n          html = `\n            ${html_top}\n            <ul>${toc_html}</ul>\n            </div>\n            ${html_bottom}\n            `;\n        } else {\n          console.error('Error: Misconfigured Jupyter Book _toc.yml.');\n        }\n      } catch (error) {\n        console.error('Error reading or parsing _toc.yml:', error);\n      }\n    }\n  } else {\n    html = `\n      <p id=\"toc-title\">Not a Jupyter-Book</p>\n      <p id=\"toc-author\">Could not find a \"_toc.yml\", \"_config.yml\", or \"myst.yml in or above the current directory:</p>\n      <p id=\"toc-author\">${cwd}</p>\n      <p id=\"toc-author\">Please navigate to a Jupyter-Book directory to view its Table of Contents</p>\n      `;\n  }\n\n  if (typeof html === 'string') {\n    html = await formatHtmlForDev(html); // no-op in prod\n    console.debug(html);\n    return html;\n  } else {\n    let errMsg = '';\n    try {\n      errMsg = JSON.stringify(html, null, 2);\n    } catch {\n      errMsg = String(html);\n    }\n    const stack =\n      (html instanceof Error && html.stack) ||\n      (typeof html === 'object' && 'stack' in (html ?? {}))\n        ? (html as any).stack\n        : '';\n\n    const escaped = escHtml(errMsg + (stack ? `\\n\\n${stack}` : ''));\n\n    return `\n      <div class=\"jbook-toc-error\" style=\"color: red; font-family: monospace; white-space: pre-wrap; padding: 1em;\">\n        <b>â ï¸ TOC generation error:</b>\n        <hr>\n        ${escaped}\n      </div>\n    `;\n  }\n}\n"],"names":[],"sourceRoot":""}